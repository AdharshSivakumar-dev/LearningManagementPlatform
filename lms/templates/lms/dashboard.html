<!doctype html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin Dashboard • Learning Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet"/>
    <link rel="stylesheet" href="/static/css/styles.css" />
  </head>
  <body class="bg-m3-surface">
    <nav class="navbar navbar-expand-lg shadow-sm m3-appbar">
      <div class="container">
        <a class="navbar-brand fw-semibold d-flex align-items-center gap-2" href="/admin/">
          <span class="material-symbols-rounded">dashboard</span> LMS Admin
        </a>
        <span class="navbar-text text-muted">Dashboard</span>
      </div>
    </nav>

    <main class="container py-4">
      <div class="p-4 mb-4 rounded-4 shadow-sm" style="background: linear-gradient(135deg, #A7C7E7, #F7C8E0);">
        <div class="d-flex align-items-center gap-3">
          <span class="material-symbols-rounded" style="font-size:36px;color:#103160;">insights</span>
          <div>
            <h4 class="mb-1" style="color:#103160;">Overview</h4>
            <p class="mb-0" style="color:#103160;">Track activity and manage content with quick actions.</p>
          </div>
        </div>
      </div>
      <div class="row g-3">
        <div class="col-md-4">
          <div class="card m3-card shadow-sm">
            <div class="card-body">
              <h6 class="card-subtitle text-muted mb-2">Total Users</h6>
              <h2 class="card-title">{{ total_users }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card m3-card shadow-sm">
            <div class="card-body">
              <h6 class="card-subtitle text-muted mb-2">Total Courses</h6>
              <h2 class="card-title">{{ total_courses }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card m3-card shadow-sm">
            <div class="card-body">
              <h6 class="card-subtitle text-muted mb-2">Total Enrollments</h6>
              <h2 class="card-title">{{ total_enrollments }}</h2>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-12">
          <div class="card m3-card shadow-sm">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="card-title mb-0">Top Enrolled Courses</h5>
                <a class="btn btn-sm btn-primary d-flex align-items-center gap-1" href="/admin/lms/course/">
                  <span class="material-symbols-rounded" style="font-size:18px;">tune</span> Manage
                </a>
              </div>
              <canvas id="topCoursesChart" height="120"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4 g-3">
        <div class="col-md-6">
          <div class="card m3-card shadow-sm">
            <div class="card-body">
              <h5 class="card-title mb-3">Monthly Revenue (INR)</h5>
              <canvas id="revenueChart" height="140"></canvas>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card m3-card shadow-sm">
            <div class="card-body">
              <h5 class="card-title mb-3">Activity Trend</h5>
              <canvas id="activityChart" height="140"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-3">
        <div class="col-12">
          <div class="card m3-card shadow-sm">
            <div class="card-body">
              <h6 class="text-muted mb-3">Quick Actions</h6>
              <div class="d-flex flex-wrap gap-2">
                <a href="/admin/lms/course/add/" class="btn btn-outline-primary d-flex align-items-center gap-1">
                  <span class="material-symbols-rounded" style="font-size:18px;">add_circle</span> New Course
                </a>
                <a href="/admin/lms/lmsuser/add/" class="btn btn-outline-primary d-flex align-items-center gap-1">
                  <span class="material-symbols-rounded" style="font-size:18px;">person_add</span> New User
                </a>
                <a href="/admin/lms/enrollment/" class="btn btn-outline-primary d-flex align-items-center gap-1">
                  <span class="material-symbols-rounded" style="font-size:18px;">group</span> Enrollments
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-3">
        <div class="col-12">
          <div class="card m3-card shadow-sm">
            <div class="card-body">
              <h6 class="text-muted mb-3">Recent Notifications</h6>
              {% if recent_notifications %}
                <ul class="list-group list-group-flush">
                  {% for n in recent_notifications %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      <span>{{ n.created_at|date:"Y-m-d H:i" }} — {{ n.user.name }}: {{ n.message }}</span>
                      {% if not n.is_read %}<span class="badge bg-primary rounded-pill">new</span>{% endif %}
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <p class="text-muted mb-0">No notifications yet.</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
      const data = {{ top_courses|safe }};
      const labels = data.map(d => d.title);
      const values = data.map(d => d.enroll_count);
      const ctx = document.getElementById('topCoursesChart').getContext('2d');
      const pastel = ['#A7C7E7','#F7C8E0','#CDEAC0','#FBE7C6','#E2ECE9','#D8E2DC'];
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'Enrollments',
            data: values,
            backgroundColor: pastel,
            borderRadius: 6
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });

      const rev = {{ revenue_series|safe }};
      const rlabels = rev.map(d => d.label);
      const rvalues = rev.map(d => d.value);
      new Chart(document.getElementById('revenueChart').getContext('2d'), {
        type: 'line',
        data: { labels: rlabels, datasets: [{ label: 'Revenue (₹)', data: rvalues, borderColor: '#6ea8fe', tension: .35 }]},
        options: { plugins:{legend:{display:false}}, scales:{ y:{beginAtZero:true}}}
      });

      const act = {{ activity_series|safe }};
      const alabels = act.map(d => d.label);
      const avalues = act.map(d => d.value);
      new Chart(document.getElementById('activityChart').getContext('2d'), {
        type: 'line',
        data: { labels: alabels, datasets: [{ label: 'Events', data: avalues, borderColor: '#f7c8e0', tension: .35 }]},
        options: { plugins:{legend:{display:false}}, scales:{ y:{beginAtZero:true}}}
      });
    </script>
  </body>
</html>
